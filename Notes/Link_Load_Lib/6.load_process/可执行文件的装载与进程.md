## 可执行文件的装载与进程

#### 1 程序与进程

程序是一个静态的概念，指的是编译好的指令和数据的集合的一个文件。

进程是一个动态的概念，是程序运行时的一个过程。

转载的方式

- 覆盖装入：已经被淘汰
- 页映射：随着虚拟内存技术出现，数据和指令分页装入；

#### 2 进程的建立：

- 创建一个独立的虚拟地址空间（实际上就是分配页目录Page Directory）
- 读取可执行文件头，建立虚拟空间与可执行文件的映射关系（当程序执行发生页错误时，操作系统从物理内存分配一个物理页，将“缺页”从磁盘读到内存，设置映射关系）
- 将CPU的指令寄存器设置成可执行文件的入口地址，启动运行（程序入口地址保存在elf文件头）

#### 3 ELF文件

<div align=center>
<img src="pic/ELF_Executable_and_Linkable_Format_diagram_by_Ange_Albertini.png" width=100% />
</div>

段的权限：

- 代码段---可读可写可执行
- 数据段和BSS段---可读可写
- 只读数据---只读

4 PAGE FAULT 页错误

ELF文件种类：

- 可重定向文件（.o）relocatable
- 可执行文件（.elf, 或者无扩展名，可直接运行）executable
- 共享目标文件（.so，可链接，或者动态连接器把.so与可执行文件结合）shared object
- 核心转储文件 core dump file

#### 4 静态ELF可执行文件加载过程总结：

1. 读取ELF_HEADER，根据魔数判断文件格式，PROGRAM_HEADER，
2. 建立映射
3. 执行

#### 5 动态链接

动态装载首先需要解决装载时地址重定位的问题

















