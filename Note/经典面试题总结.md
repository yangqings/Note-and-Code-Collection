## 经典面试题总结

#### 1. malloc和new的区别

- 属性区别：new/delete是C++关键字，需要编译器支持；malloc/free是库函数，需要include头文件
- 输入参数区别：new申请内存分配时不需要指定内存块大小，编译器自动计算，malloc需要显示指定申请的内存大小；
- 返回类型：new成功返回对象类型指针，严格匹配，无需类型转换，符合类型安全性操作；malloc成功返回void*，需要强制类型转换；
- 分配失败：new会抛出bac_alloc异常，malloc返回NULL；
- 自定义类型： new调用operator new函数，申请足够的内存（底层调用malloc实现），调用类型析构造函数，初始化成员变量，最后返回自定义类型指针。delete先调用析构函数，然后调用operator delete函数释放内存（底层调free函数实现）
- 重载：
- 内存区域：new从自由存储区（free store）上为对象动态分配内存空间，malloc从堆分配。自由存储区是C++基于new操作符的一个抽象概念，凡是通过new操作符进行内存申请，该内存即为自由存储区。而堆是操作系统中的术语，是操作系统所维护的一块特殊内存，用于程序的内存动态分配，C语言使用malloc从堆上分配内存，使用free释放已分配的对应内存。自由存储区不等于堆，如上所述，布局new就可以不位于堆中。

C++的内存布局：内存区分为5个区，分别是堆、栈、自由存储区、全局/静态存储区、常量存储区。堆是操作系统维护的一块内存，是一个物理概念，而自由存储是C++中通过new与delete动态分配和释放的对象的存储区，是一个逻辑概念。C++标准并没有给出new/delete应该如何实现，但很多编译器的new/delete都是以malloc/free为基础来实现的。从技术上来说，堆（heap）是C语言和操作系统的术语，堆是操作系统所维护的一块特殊内存，它提供了动态分配的功能，使用malloc()、free（）来申请/释放内存。而自由存储是C++中通过new和delete动态分配和释放对象的抽象概念。基本上，所有的C++编译器默认使用堆来实现自由存储。也就是说，默认的全局运算符new和delete也许会使用malloc和free的方式申请和释放存储空间，也就是说自由存储区就位于堆上。但程序员也可以通过重载操作符，改用其他内存来实现自由存储，例如全局变量做的对象池，这时自由存储区就不位于堆上了